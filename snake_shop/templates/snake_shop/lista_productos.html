{% extends "snake_shop/base.html" %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-3">
            <h3 class="mb-3">Categorías</h3>
            <div class="list-group">
                <a href="{% url 'lista_productos' %}" class="list-group-item list-group-item-action {% if not categoria %}active{% endif %}">
                    Todas
                </a>
                {% for c in categorias %}
                <!-- <a href="{% url 'lista_productos_por_categoria' c.slug %}?q={{ query }}" class="list-group-item list-group-item-action {% if categoria and categoria.slug == c.slug %} active {% endif %}">
                    {{ c.nombre }}git
                </a> -->
                <a href="{% url 'lista_productos_por_categoria' c.slug %}{% if query %}?q={{ query }}{% endif %}" class="list-group-item list-group-item-action {% if categoria and categoria.slug == c.slug %} active {% endif %}">
                    {{ c.nombre }}
                </a>
                {% endfor %}
            </div>
        </div>
    

        <div class="col-md-9">
            {% if not productos %}
                <div class="alert alert-warning">
                    No se encontraron productos para "<strong>{{ query }}</strong>"
                </div>
            {% endif %}
            <!-- titulo -->
            <h1 style="text-align: center">{% if categoria %}{{ categoria.nombre }}{% else %}Nuestros Productos{% endif %}</h1>
            <form method="get" class="mb-4">
                <div class="input-group">
                    <input type="text" name="q" class="form-control" placeholder="Buscar productos..." value="{{ query|default:'' }}">
                    <button class="btn btn-primary" type="submit">
                        <i class="bi bi-search"></i>
                    </button>
                </div>
            </form>
            <!-- carrusell -->
            <div id="carouselPromociones" class="carousel slide" data-bs-ride="carousel" data-bs-interval="1500">
                <div class="carousel-indicators">
                    {% for promo in productos_promocion %}
                    <button type="button" data-bs-target="#carouselPromociones" data-bs-slide-to="{{ forloop.counter0 }}"
                        class="{% if forloop.first %}active{% endif %}" 
                        aria-current="{% if forloop.first %}true{% endif %}" 
                        aria-label="Slide {{ forloop.counter }}"></button>
                    {% endfor %}
                </div>
                <div class="carousel-inner">
                    {% for promo in productos_promocion %}
                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                        <div class="promo-overlay d-flex align-items-center justify-content-center text-white text-center" 
                            style="background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('{{ promo.imagen.url }}'); 
                                background-size: cover; background-position: center; height: 400px;">
                            <div class="container">
                                <div class="row justify-content-center">
                                    <div class="col-md-8">
                                        <div class="mb-4 fs-1">
                                            {% if promo.precio_promocion %}
                                            <span class="text-decoration-line-through me-3 fs-4">${{ promo.precio }}</span>
                                            <span class="text-warning fw-bold">${{ promo.precio_promocion }}</span>
                                            {% else %}
                                            <span class="text-white fw-bold">${{ promo.precio }}</span>
                                            {% endif %}
                                        </div>
                                        <a href="{% url 'detalle_producto' promo.slug %}" class="btn btn-warning btn-lg px-3 py-3 fw-bold">
                                            VER PRODUCTO <i class="bi bi-arrow-right ms-2"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="carousel-item active">
                        <img src="https://placehold.in/1000x400" class="d-block w-100" alt="Sin promociones">
                        <div class="carousel-caption d-none d-md-block">
                            <h5>No hay promociones activas</h5>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- lista de productos -->
            <div class="product-list">
                {% for producto in productos %}
                    <div class="product-card">
                        {% if producto.imagen %}
                            <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}">{% endif %}
                        <h3><a href="{% url 'detalle_producto' product_slug=producto.slug %}">{{ producto.nombre }}</a>
                        </h3>
                        {% if producto.en_promocion and producto.precio_promocion %}
                        <p><span class="text-muted text-decoration-line-through">{{ producto.precio }}</span>
                            <span class="text-danger fw-bold fs-4">${{ producto.precio_promocion }}</span>
                            <span class="badge bg-success">¡En Promoción!</span></p>
                        {% else %}
                            <p>{{ producto.precio }}</p>
                        {% endif %}

                    </div>
                {% empty %}
                    <div class="alert alert-info" role="alert">
                        No hay productos disponibles en esta categoría.
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
